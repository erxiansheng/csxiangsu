class Minimap{constructor(i){this.game=i,this.canvas=null,this.ctx=null,this.size=180,this.playerSize=6,this.isMobile=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)||"ontouchstart"in window||navigator.maxTouchPoints>0,this.init()}init(){const i=document.createElement("div");i.id="minimap-container",i.innerHTML=`\n            <canvas id="minimap-canvas" width="${this.size}" height="${this.size}"></canvas>\n            <div id="minimap-labels">\n                <span class="site-label" id="minimap-site-a">A</span>\n                <span class="site-label" id="minimap-site-b">B</span>\n            </div>\n        `,document.getElementById("game").appendChild(i),this.canvas=document.getElementById("minimap-canvas"),this.ctx=this.canvas.getContext("2d")}getDisplaySize(){return this.isMobile?120:this.size}getMapSize(){const i=MapConfigs[this.game.selectedMap];return i&&i.mapSize||125}worldToMinimap(i,t){const s=this.getMapSize(),n=this.size/2,h=this.size/(2*s);return{x:n+i*h,y:n+t*h}}getMinimapAngle(i){return-i-Math.PI/2}update(){if(!this.ctx||!this.game.camera)return;const i=this.ctx,t=MapConfigs[this.game.selectedMap]||MapConfigs.indoor;if(!t)return;i.clearRect(0,0,this.size,this.size),i.fillStyle="rgba(0, 0, 0, 0.7)",i.fillRect(0,0,this.size,this.size),i.strokeStyle="#e94560",i.lineWidth=2,i.strokeRect(0,0,this.size,this.size);const s=this.getMapSize(),n=this.size/(2*s);if(i.fillStyle="rgba(85, 85, 85, 0.6)",i.strokeStyle="rgba(100, 100, 100, 0.8)",i.lineWidth=2,i.strokeRect(2,2,this.size-4,this.size-4),i.fillStyle="rgba(139, 115, 85, 0.7)",i.lineWidth=1,t.obstacles&&t.obstacles.length>0&&t.obstacles.forEach(t=>{if("floor"===t.textureType||"floor"===t.type||"roof"===t.type||t.isRoof)return;if(t.h<=1)return;const s=this.worldToMinimap(t.x,t.z),h=Math.max(1,t.w*n),a=Math.max(1,t.d*n);i.save(),i.translate(s.x,s.y),t.rotation&&i.rotate(t.rotation),i.fillRect(-h/2,-a/2,h,a),i.restore()}),this.game.isDefuseMode&&t.bombSites){if(i.globalAlpha=.3+.1*Math.sin(Date.now()/500),t.bombSites.A){const s=this.worldToMinimap(t.bombSites.A.x,t.bombSites.A.z),h=t.bombSites.A.radius*n;i.fillStyle="A"===this.game.c4Site?"#ff0000":"#ff6600",i.beginPath(),i.arc(s.x,s.y,h,0,2*Math.PI),i.fill(),i.globalAlpha=1,i.fillStyle="#ffffff",i.font="bold 16px Arial",i.textAlign="center",i.textBaseline="middle",i.fillText("A",s.x,s.y),i.globalAlpha=.3+.1*Math.sin(Date.now()/500)}if(t.bombSites.B){const s=this.worldToMinimap(t.bombSites.B.x,t.bombSites.B.z),h=t.bombSites.B.radius*n;i.fillStyle="B"===this.game.c4Site?"#ff0000":"#ff6600",i.beginPath(),i.arc(s.x,s.y,h,0,2*Math.PI),i.fill(),i.globalAlpha=1,i.fillStyle="#ffffff",i.font="bold 16px Arial",i.textAlign="center",i.textBaseline="middle",i.fillText("B",s.x,s.y),i.globalAlpha=.3+.1*Math.sin(Date.now()/500)}i.globalAlpha=1;const s=document.getElementById("minimap-site-a"),h=document.getElementById("minimap-site-b");s&&(s.style.display="none"),h&&(h.style.display="none")}else{const i=document.getElementById("minimap-site-a"),t=document.getElementById("minimap-site-b");i&&(i.style.display="none"),t&&(t.style.display="none")}if(this.game.c4Planted&&this.game.c4Position){const t=this.worldToMinimap(this.game.c4Position.x,this.game.c4Position.z),s=.5*Math.sin(Date.now()/200)+.5;i.fillStyle=`rgba(255, 0, 0, ${.5+.5*s})`,i.beginPath(),i.arc(t.x,t.y,5+2*s,0,2*Math.PI),i.fill(),i.fillStyle="#fff",i.font="bold 10px Arial",i.textAlign="center",i.textBaseline="middle",i.fillText("ðŸ’£",t.x,t.y)}if(Object.entries(this.game.players).forEach(([t,s])=>{if(t!==this.game.playerId&&s.is_alive&&s.team===this.game.selectedTeam){const t=this.worldToMinimap(s.x,s.y),n=this.getMinimapAngle(s.angle||0);i.fillStyle="#00ff00",i.strokeStyle="#00ff00",i.beginPath(),i.arc(t.x,t.y,this.playerSize/2,0,2*Math.PI),i.fill(),i.lineWidth=2,i.beginPath(),i.moveTo(t.x,t.y),i.lineTo(t.x+Math.cos(n)*this.playerSize*1.5,t.y+Math.sin(n)*this.playerSize*1.5),i.stroke()}}),this.game.camera){const t=this.worldToMinimap(this.game.camera.position.x,this.game.camera.position.z),s=this.getMinimapAngle(this.game.yaw);i.fillStyle="rgba(255, 255, 0, 0.15)",i.beginPath(),i.moveTo(t.x,t.y);const n=Math.PI/6;i.arc(t.x,t.y,35,s-n,s+n),i.closePath(),i.fill(),i.fillStyle="#ffff00",i.save(),i.translate(t.x,t.y),i.rotate(s+Math.PI/2),i.beginPath(),i.moveTo(0,-this.playerSize),i.lineTo(-this.playerSize/2,this.playerSize/2),i.lineTo(this.playerSize/2,this.playerSize/2),i.closePath(),i.fill(),i.strokeStyle="#000",i.lineWidth=1,i.stroke(),i.restore()}}show(){const i=document.getElementById("minimap-container");i&&(i.style.display="block")}hide(){const i=document.getElementById("minimap-container");i&&(i.style.display="none")}}