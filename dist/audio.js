class AudioSystem{constructor(){this.audioCtx=null,this.lastFootstep=0,this.footstepInterval=400,this.masterVolume=1,this.sounds={},this.soundsLoaded=!1}init(){this.audioCtx=new(window.AudioContext||window.webkitAudioContext),this.masterGain=this.audioCtx.createGain(),this.masterGain.connect(this.audioCtx.destination),this.loadSounds()}setVolume(i){this.masterVolume=i,this.masterGain&&(this.masterGain.gain.value=i)}async loadSounds(){const i=Object.entries({ak47_1:"yinxiao/weapons/ak47-1.wav",ak47_2:"yinxiao/weapons/ak47-2.wav",ak47_clipin:"yinxiao/weapons/ak47_clipin.wav",ak47_clipout:"yinxiao/weapons/ak47_clipout.wav",ak47_boltpull:"yinxiao/weapons/ak47_boltpull.wav",m4a1_1:"yinxiao/weapons/m4a1-1.wav",m4a1_unsil_1:"yinxiao/weapons/m4a1_unsil-1.wav",m4a1_unsil_2:"yinxiao/weapons/m4a1_unsil-2.wav",m4a1_clipin:"yinxiao/weapons/m4a1_clipin.wav",m4a1_clipout:"yinxiao/weapons/m4a1_clipout.wav",m4a1_boltpull:"yinxiao/weapons/m4a1_boltpull.wav",m4a1_deploy:"yinxiao/weapons/m4a1_deploy.wav",awp_1:"yinxiao/weapons/awp1.wav",awp_clipin:"yinxiao/weapons/awp_clipin.wav",awp_clipout:"yinxiao/weapons/awp_clipout.wav",awp_deploy:"yinxiao/weapons/awp_deploy.wav",awp_zoom:"yinxiao/weapons/zoom.wav",usp_1:"yinxiao/weapons/usp1.wav",usp_2:"yinxiao/weapons/usp2.wav",usp_unsil:"yinxiao/weapons/usp_unsil-1.wav",usp_clipin:"yinxiao/weapons/usp_clipin.wav",usp_clipout:"yinxiao/weapons/usp_clipout.wav",usp_slideback:"yinxiao/weapons/usp_slideback.wav",usp_sliderelease:"yinxiao/weapons/usp_sliderelease.wav",knife_deploy:"yinxiao/weapons/knife_deploy1.wav",knife_slash1:"yinxiao/weapons/knife_slash1.wav",knife_slash2:"yinxiao/weapons/knife_slash2.wav",knife_hit1:"yinxiao/weapons/knife_hit1.wav",knife_hit2:"yinxiao/weapons/knife_hit2.wav",knife_hitwall:"yinxiao/weapons/knife_hitwall1.wav",knife_stab:"yinxiao/weapons/knife_stab.wav",pinpull:"yinxiao/weapons/pinpull.wav",grenade_hit1:"yinxiao/weapons/grenade_hit1.wav",grenade_hit2:"yinxiao/weapons/grenade_hit2.wav",he_bounce:"yinxiao/weapons/he_bounce-1.wav",explosion1:"yinxiao/weapons/hegrenade-1.wav",explosion2:"yinxiao/weapons/hegrenade-2.wav",c4_explode:"yinxiao/weapons/c4_explode1.wav",c4_plant:"yinxiao/weapons/c4_plant.wav",c4_disarm:"yinxiao/weapons/c4_disarm.wav",c4_disarmed:"yinxiao/weapons/c4_disarmed.wav",c4_beep1:"yinxiao/weapons/c4_beep1.wav",c4_beep2:"yinxiao/weapons/c4_beep2.wav",c4_beep3:"yinxiao/weapons/c4_beep3.wav",c4_beep4:"yinxiao/weapons/c4_beep4.wav",c4_beep5:"yinxiao/weapons/c4_beep5.wav",headshot:"yinxiao/weapons/headshot2.wav",headshot_gr:"yinxiao/liansha/Headshot_GR.wav",knifekill:"yinxiao/liansha/Knifekill_GR.wav",multikill_2:"yinxiao/liansha/MultiKill_2_GR.wav",multikill_3:"yinxiao/liansha/MultiKill_3_GR.wav",multikill_4:"yinxiao/liansha/MultiKill_4_GR.wav",multikill_5:"yinxiao/liansha/MultiKill_5_GR.wav",multikill_6:"yinxiao/liansha/MultiKill_6_GR.wav",multikill_7:"yinxiao/liansha/MultiKill_7_GR.wav",multikill_8:"yinxiao/liansha/MultiKill_8_GR.wav",die1:"yinxiao/player/die1.wav",die2:"yinxiao/player/die2.wav",die3:"yinxiao/player/die3.wav",death6:"yinxiao/player/death6.wav",dryfire_rifle:"yinxiao/weapons/dryfire_rifle.wav",dryfire_pistol:"yinxiao/weapons/dryfire_pistol.wav"}).map(async([i,t])=>{try{const s=await fetch(t);if(!s.ok)return void console.warn(`Sound file not found: ${t}`);const a=await s.arrayBuffer();this.sounds[i]=await this.audioCtx.decodeAudioData(a),console.log(`Loaded sound: ${i}`)}catch(i){console.warn(`Failed to load sound: ${t}`,i)}});await Promise.all(i),this.soundsLoaded=!0,console.log("Sound loading complete. Loaded:",Object.keys(this.sounds))}playSound(i,t=1){if(!this.audioCtx||!this.sounds[i])return;const s=this.audioCtx.createBufferSource();s.buffer=this.sounds[i];const a=this.audioCtx.createGain();a.gain.value=t,s.connect(a),a.connect(this.masterGain),s.start()}playAK47Sound(){if(this.sounds.ak47_1&&this.sounds.ak47_2){const i=Math.random()>.5?"ak47_1":"ak47_2";return void this.playSound(i,.6)}this.sounds.ak47_1?this.playSound("ak47_1",.6):this.sounds.ak47_2?this.playSound("ak47_2",.6):this.playAK47SoundSynth()}playAK47SoundSynth(){if(!this.audioCtx)return;const i=this.audioCtx,t=.15*i.sampleRate,s=i.createBuffer(1,t,i.sampleRate),a=s.getChannelData(0);for(let s=0;s<t;s++){const n=s/t,o=2*Math.random()-1,e=Math.sin(2*Math.PI*150*n/i.sampleRate);a[s]=(.7*o+.3*e)*Math.exp(20*-n)*1.5}const n=i.createBufferSource();n.buffer=s;const o=i.createBiquadFilter();o.type="lowpass",o.frequency.value=2e3;const e=i.createBiquadFilter();e.type="highpass",e.frequency.value=100;const h=i.createGain();h.gain.value=1.5,n.connect(o),o.connect(e),e.connect(h),h.connect(this.masterGain),n.start()}playM4A1Sound(){if(this.sounds.m4a1_1)this.playSound("m4a1_1",.6);else{if(this.sounds.m4a1_unsil_1&&this.sounds.m4a1_unsil_2){const i=Math.random()>.5?"m4a1_unsil_1":"m4a1_unsil_2";return void this.playSound(i,.6)}this.sounds.m4a1_unsil_1?this.playSound("m4a1_unsil_1",.6):this.sounds.m4a1_unsil_2?this.playSound("m4a1_unsil_2",.6):this.playM4A1SoundSynth()}}playM4A1SoundSynth(){if(!this.audioCtx)return;const i=this.audioCtx,t=.12*i.sampleRate,s=i.createBuffer(1,t,i.sampleRate),a=s.getChannelData(0);for(let s=0;s<t;s++){const n=s/t,o=2*Math.random()-1,e=Math.sin(2*Math.PI*2e3*n/i.sampleRate)*Math.exp(50*-n);a[s]=(.6*o+.4*e)*Math.exp(25*-n)*1.2}const n=i.createBufferSource();n.buffer=s;const o=i.createBiquadFilter();o.type="bandpass",o.frequency.value=1500,o.Q.value=1;const e=i.createGain();e.gain.value=1.3,n.connect(o),o.connect(e),e.connect(this.masterGain),n.start()}playAK47ReloadSound(){this.sounds.ak47_clipout&&this.playSound("ak47_clipout",.5),setTimeout(()=>{this.sounds.ak47_clipin&&this.playSound("ak47_clipin",.5)},600),setTimeout(()=>{this.sounds.ak47_boltpull&&this.playSound("ak47_boltpull",.5)},1200)}playM4A1ReloadSound(){this.sounds.m4a1_clipout&&this.playSound("m4a1_clipout",.5),setTimeout(()=>{this.sounds.m4a1_clipin&&this.playSound("m4a1_clipin",.5)},600),setTimeout(()=>{this.sounds.m4a1_boltpull&&this.playSound("m4a1_boltpull",.5)},1200)}playAWPSound(){if(this.sounds.awp_1)return void this.playSound("awp_1",.7);if(!this.audioCtx)return;const i=this.audioCtx,t=.5*i.sampleRate,s=i.createBuffer(1,t,i.sampleRate),a=s.getChannelData(0);for(let s=0;s<t;s++){const n=s/t,o=Math.sin(2*Math.PI*60*n/i.sampleRate),e=2*Math.random()-1;a[s]=(.6*o+.4*e)*Math.exp(8*-n)*2}const n=i.createBufferSource();n.buffer=s;const o=i.createBiquadFilter();o.type="lowpass",o.frequency.value=800;const e=i.createGain();e.gain.value=2,n.connect(o),o.connect(e),e.connect(this.masterGain),n.start()}playAWPReloadSound(){this.sounds.awp_clipout&&this.playSound("awp_clipout",.5),setTimeout(()=>{this.sounds.awp_clipin&&this.playSound("awp_clipin",.5)},800)}playZoomSound(){this.sounds.awp_zoom&&this.playSound("awp_zoom",.4)}playPistolSound(){if(this.sounds.usp_1&&this.sounds.usp_2){const i=Math.random()>.5?"usp_1":"usp_2";return void this.playSound(i,.6)}if(this.sounds.usp_1)return void this.playSound("usp_1",.6);if(this.sounds.usp_unsil)return void this.playSound("usp_unsil",.6);if(!this.audioCtx)return;const i=this.audioCtx,t=.1*i.sampleRate,s=i.createBuffer(1,t,i.sampleRate),a=s.getChannelData(0);for(let s=0;s<t;s++){const n=s/t,o=Math.sin(2*Math.PI*800*n/i.sampleRate);a[s]=(.5*Math.random()+.5*o)*Math.exp(35*-n)}const n=i.createBufferSource();n.buffer=s;const o=i.createGain();o.gain.value=.9,n.connect(o),o.connect(this.masterGain),n.start()}playPistolReloadSound(){this.sounds.usp_clipout&&this.playSound("usp_clipout",.5),setTimeout(()=>{this.sounds.usp_clipin&&this.playSound("usp_clipin",.5)},400),setTimeout(()=>{this.sounds.usp_slideback&&this.playSound("usp_slideback",.5)},800),setTimeout(()=>{this.sounds.usp_sliderelease&&this.playSound("usp_sliderelease",.5)},1e3)}playGunSound(i){switch(i){case"ak47":this.playAK47Sound();break;case"m4a1":this.playM4A1Sound();break;case"awp":this.playAWPSound();break;case"pistol":this.playPistolSound()}}playRemoteGunSound(i,t=.5){if(!this.audioCtx)return;let s=null;switch(i){case"ak47":s=this.sounds.ak47_1?"ak47_1":this.sounds.ak47_2?"ak47_2":null;break;case"m4a1":s=this.sounds.m4a1_1?"m4a1_1":this.sounds.m4a1_unsil_1?"m4a1_unsil_1":null;break;case"awp":s=this.sounds.awp_1?"awp_1":null;break;case"pistol":s=this.sounds.usp_1?"usp_1":this.sounds.usp_2?"usp_2":null;break;case"knife":s=this.sounds.knife_slash1?"knife_slash1":null}s&&this.sounds[s]?this.playSound(s,t):this.playRemoteGunSoundSynth(i,t)}playRemoteGunSoundSynth(i,t=.5){if(!this.audioCtx)return;const s=this.audioCtx;let a,n;switch(i){case"awp":a=.3,n=60;break;case"pistol":a=.08,n=400;break;default:a=.12,n=150}const o=s.sampleRate*a,e=s.createBuffer(1,o,s.sampleRate),h=e.getChannelData(0);for(let i=0;i<o;i++){const a=i/o,e=2*Math.random()-1,l=Math.sin(2*Math.PI*n*a/s.sampleRate);h[i]=(.6*e+.4*l)*Math.exp(15*-a)*t}const l=s.createBufferSource();l.buffer=e;const p=s.createBiquadFilter();p.type="lowpass",p.frequency.value=1500;const u=s.createGain();u.gain.value=t,l.connect(p),p.connect(u),u.connect(this.masterGain),l.start()}playFootstep(){if(!this.audioCtx)return;const i=Date.now();if(i-this.lastFootstep<this.footstepInterval)return;this.lastFootstep=i;const t=this.audioCtx,s=t.createOscillator();s.type="sine",s.frequency.value=80+40*Math.random();const a=t.createGain();a.gain.setValueAtTime(.15,t.currentTime),a.gain.exponentialRampToValueAtTime(.01,t.currentTime+.1),s.connect(a),a.connect(this.masterGain),s.start(),s.stop(t.currentTime+.1)}playReloadSound(i="ak47"){if("ak47"===i&&this.sounds.ak47_clipout)return void this.playAK47ReloadSound();if("m4a1"===i&&this.sounds.m4a1_clipout)return void this.playM4A1ReloadSound();if("awp"===i&&this.sounds.awp_clipout)return void this.playAWPReloadSound();if("pistol"===i&&this.sounds.usp_clipout)return void this.playPistolReloadSound();if(!this.audioCtx)return;const t=this.audioCtx,s=this.masterGain;setTimeout(()=>{const i=.1*t.sampleRate,a=t.createBuffer(1,i,t.sampleRate),n=a.getChannelData(0);for(let t=0;t<i;t++)n[t]=(2*Math.random()-1)*Math.exp(-t/i*10)*.3;const o=t.createBufferSource();o.buffer=a,o.connect(s),o.start()},200),setTimeout(()=>{const i=.15*t.sampleRate,a=t.createBuffer(1,i,t.sampleRate),n=a.getChannelData(0);for(let t=0;t<i;t++){const s=t/i;n[t]=Math.sin(2*Math.PI*400*s)*Math.exp(15*-s)*.4}const o=t.createBufferSource();o.buffer=a,o.connect(s),o.start()},800)}playHitSound(){if(!this.audioCtx)return;const i=this.audioCtx,t=i.createOscillator();t.type="sine",t.frequency.value=800;const s=i.createGain();s.gain.setValueAtTime(.2,i.currentTime),s.gain.exponentialRampToValueAtTime(.01,i.currentTime+.1),t.connect(s),s.connect(this.masterGain),t.start(),t.stop(i.currentTime+.1)}playWeaponSwitchSound(){if(!this.audioCtx)return;const i=this.audioCtx,t=.15*i.sampleRate,s=i.createBuffer(1,t,i.sampleRate),a=s.getChannelData(0);for(let i=0;i<t;i++){const s=i/t;a[i]=(.3*Math.random()+.2*Math.sin(2*Math.PI*300*s))*Math.exp(12*-s)}const n=i.createBufferSource();n.buffer=s,n.connect(this.masterGain),n.start()}playGrenadeThrowSound(){if(this.sounds.pinpull)this.playSound("pinpull",.5);else{if(!this.audioCtx)return;const i=this.audioCtx,t=i.createOscillator();t.type="sawtooth",t.frequency.setValueAtTime(200,i.currentTime),t.frequency.exponentialRampToValueAtTime(100,i.currentTime+.2);const s=i.createGain();s.gain.setValueAtTime(.2,i.currentTime),s.gain.exponentialRampToValueAtTime(.01,i.currentTime+.2),t.connect(s),s.connect(this.masterGain),t.start(),t.stop(i.currentTime+.2)}}playGrenadeBounceSound(){this.sounds.he_bounce?this.playSound("he_bounce",.4):this.sounds.grenade_hit1&&this.playSound("grenade_hit1",.4)}playHeadshotSound(){this.sounds.headshot&&this.playSound("headshot",.7)}playHeadshotVoice(){this.sounds.headshot_gr&&this.playSound("headshot_gr",.8)}playKnifeKillVoice(){this.sounds.knifekill&&this.playSound("knifekill",.8)}playMultiKillVoice(i){const t=`multikill_${Math.min(Math.max(i,2),8)}`;this.sounds[t]&&this.playSound(t,.9)}playDeathSound(){const i=["die1","die2","die3","death6"].filter(i=>this.sounds[i]);if(i.length>0){const t=i[Math.floor(Math.random()*i.length)];return void this.playSound(t,.8)}if(!this.audioCtx)return;const t=this.audioCtx,s=.5*t.sampleRate,a=t.createBuffer(1,s,t.sampleRate),n=a.getChannelData(0);for(let i=0;i<s;i++){const t=i/s;n[i]=Math.sin(2*Math.PI*(200-150*t)*t)*Math.exp(4*-t)*.5}const o=t.createBufferSource();o.buffer=a,o.connect(this.masterGain),o.start()}playKnifeSound(){if(this.sounds.knife_slash1&&this.sounds.knife_slash2){const i=Math.random()>.5?"knife_slash1":"knife_slash2";return void this.playSound(i,.6)}if(this.sounds.knife_slash1)return void this.playSound("knife_slash1",.6);if(!this.audioCtx)return;const i=this.audioCtx,t=i.createOscillator();t.type="sawtooth",t.frequency.setValueAtTime(300,i.currentTime),t.frequency.exponentialRampToValueAtTime(100,i.currentTime+.15);const s=i.createGain();s.gain.setValueAtTime(.2,i.currentTime),s.gain.exponentialRampToValueAtTime(.01,i.currentTime+.15),t.connect(s),s.connect(this.masterGain),t.start(),t.stop(i.currentTime+.15)}playKnifeHitSound(){if(this.sounds.knife_hit1&&this.sounds.knife_hit2){const i=Math.random()>.5?"knife_hit1":"knife_hit2";return void this.playSound(i,.6)}this.sounds.knife_hit1&&this.playSound("knife_hit1",.6)}playKnifeStabSound(){this.sounds.knife_stab&&this.playSound("knife_stab",.6)}playKnifeDeploySound(){this.sounds.knife_deploy&&this.playSound("knife_deploy",.5)}playExplosionSound(){if(this.sounds.explosion1&&this.sounds.explosion2){const i=Math.random()>.5?"explosion1":"explosion2";return void this.playSound(i,.8)}if(this.sounds.explosion1)return void this.playSound("explosion1",.8);if(this.sounds.c4_explode)return void this.playSound("c4_explode",.8);if(!this.audioCtx)return;const i=this.audioCtx,t=.8*i.sampleRate,s=i.createBuffer(1,t,i.sampleRate),a=s.getChannelData(0);for(let i=0;i<t;i++){const s=i/t,n=Math.sin(2*Math.PI*40*s)*Math.exp(3*-s),o=Math.sin(2*Math.PI*120*s)*Math.exp(6*-s),e=(2*Math.random()-1)*Math.exp(10*-s);a[i]=2.5*(.5*n+.3*o+.2*e)}const n=i.createBufferSource();n.buffer=s;const o=i.createBiquadFilter();o.type="lowpass",o.frequency.value=500;const e=i.createGain();e.gain.value=2.5,n.connect(o),o.connect(e),e.connect(this.masterGain),n.start()}playC4PlantSound(){this.sounds.c4_plant&&this.playSound("c4_plant",.7)}playC4DefuseSound(){this.sounds.c4_disarm&&this.playSound("c4_disarm",.6)}playC4DefusedSound(){this.sounds.c4_disarmed&&this.playSound("c4_disarmed",.8)}playC4ExplodeSound(){this.sounds.c4_explode?this.playSound("c4_explode",1):this.playExplosionSound()}playC4BeepSound(i){let t="c4_beep1";i<=5?t="c4_beep5":i<=10?t="c4_beep4":i<=20?t="c4_beep3":i<=30&&(t="c4_beep2"),this.sounds[t]&&this.playSound(t,.5)}}